# ğŸ“Š ç«¶é¦¬ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†ã‚¬ã‚¤ãƒ‰

## ğŸ¯ æ¦‚è¦

ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€ç«¶é¦¬ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰`distance`ï¼ˆè·é›¢ï¼‰ã‚’ã¯ã˜ã‚ã¨ã™ã‚‹é‡è¦ãªç‰¹å¾´é‡ã‚’æŠ½å‡ºã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ” å•é¡Œã®èƒŒæ™¯

å…ƒã®CSVãƒ‡ãƒ¼ã‚¿ã«ã¯`distance`ã‚«ãƒ©ãƒ ãŒ**ç›´æ¥å­˜åœ¨ã—ã¾ã›ã‚“**ã€‚
ä»£ã‚ã‚Šã«`race_details`ã‚«ãƒ©ãƒ ã«ä»¥ä¸‹ã®ã‚ˆã†ãªå½¢å¼ã§æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ï¼š

```
èŠå³1800m / å¤©å€™ : æ›‡ / èŠ : è‰¯  / ç™ºèµ° : 09:50
ãƒ€å³1000m / å¤©å€™ : æ™´ / ãƒ€ãƒ¼ãƒˆ : è‰¯  / ç™ºèµ° : 10:15
```

ã“ã®ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰æ§‹é€ åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

## âœ¨ æŠ½å‡ºã•ã‚Œã‚‹æƒ…å ±

å‰å‡¦ç†ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ä»¥ä¸‹ã®æƒ…å ±ã‚’è‡ªå‹•æŠ½å‡ºã—ã¾ã™ï¼š

| ã‚«ãƒ©ãƒ å | èª¬æ˜ | ä¾‹ |
|---------|------|-----|
| `race_date` | ãƒ¬ãƒ¼ã‚¹æ—¥ä»˜ | 2019-01-01 |
| `distance` | è·é›¢ï¼ˆãƒ¡ãƒ¼ãƒˆãƒ«ï¼‰ | 1800 |
| `course_type` | ã‚³ãƒ¼ã‚¹ç¨®åˆ¥ | turf / dirt |
| `track_direction` | ã‚³ãƒ¼ã‚¹å›ã‚Š | right / left / straight |
| `weather` | å¤©å€™ | sunny / cloudy / rainy |
| `track_condition` | é¦¬å ´çŠ¶æ…‹ | firm / good / yielding / soft |

## ğŸš€ ä½¿ã„æ–¹

### æ–¹æ³•1: å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†

```bash
python preprocess_race_data.py horse_race_data_2019.csv
```

**çµæœï¼š**
- `horse_race_data_2019_processed.csv` ãŒä½œæˆã•ã‚Œã‚‹
- å…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ãã®ã¾ã¾æ®‹ã‚‹

### æ–¹æ³•2: å‡ºåŠ›å…ˆã‚’æŒ‡å®š

```bash
python preprocess_race_data.py horse_race_data_2019.csv data/processed_2019.csv
```

### æ–¹æ³•3: è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸€æ‹¬å‡¦ç†

```bash
python batch_preprocess.py horse_race_data_*.csv
```

ã¾ãŸã¯

```bash
python batch_preprocess.py data/race_2019.csv data/race_2020.csv data/race_2021.csv
```

## ğŸ“‹ å®Ÿè¡Œä¾‹

### å®Ÿè¡Œå‰ã®ãƒ‡ãƒ¼ã‚¿

```csv
race_id,race_name,rank,horse_name,race_details
201901010101,2æ­³æœªå‹åˆ©,1,ã‚´ãƒ«ã‚³ãƒ³ãƒ€,"èŠå³1800m / å¤©å€™ : æ›‡ / èŠ : è‰¯"
```

### å®Ÿè¡Œå¾Œã®ãƒ‡ãƒ¼ã‚¿

```csv
race_id,race_name,rank,horse_name,race_details,race_date,distance,course_type,track_direction,weather,track_condition
201901010101,2æ­³æœªå‹åˆ©,1,ã‚´ãƒ«ã‚³ãƒ³ãƒ€,"èŠå³1800m / å¤©å€™ : æ›‡ / èŠ : è‰¯",2019-01-01,1800,turf,right,cloudy,firm
```

## ğŸ¨ å‡¦ç†çµæœã®ä¾‹

å®Ÿéš›ã®`horse_race_data_2019.csv`ã‚’å‡¦ç†ã—ãŸçµæœï¼š

```
ğŸ“Š æŠ½å‡ºçµæœã‚µãƒãƒªãƒ¼
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   race_date           :   47,574 / 47,574 (100.0%)
   distance            :   47,574 / 47,574 (100.0%)
   course_type         :   47,574 / 47,574 (100.0%)
   track_direction     :   46,002 / 47,574 (96.7%)
   weather             :   47,574 / 47,574 (100.0%)
   track_condition     :   47,574 / 47,574 (100.0%)

ğŸ“ è·é›¢ã®åˆ†å¸ƒ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   æœ€å°: 1000m
   æœ€å¤§: 4250m
   å¹³å‡: 1649m
   ä¸­å¤®å€¤: 1600m
```

âœ… **100%ã®æˆåŠŸç‡**ã§è·é›¢ã‚’æŠ½å‡ºï¼

## ğŸ”§ Pythonã‚³ãƒ¼ãƒ‰å†…ã§ã®ä½¿ç”¨

```python
from preprocess_race_data import preprocess_race_data

# ãƒ‡ãƒ¼ã‚¿ã‚’å‰å‡¦ç†
df = preprocess_race_data(
    input_csv="horse_race_data_2019.csv",
    output_csv="processed_data.csv"
)

# è·é›¢ã®ç¢ºèª
print(df['distance'].describe())

# èŠã¨ãƒ€ãƒ¼ãƒˆã®å†…è¨³
print(df['course_type'].value_counts())
```

## ğŸ“Š æŠ½å‡ºã•ã‚Œã‚‹å€¤ã®è©³ç´°

### ã‚³ãƒ¼ã‚¹ç¨®åˆ¥ï¼ˆcourse_typeï¼‰

| æ—¥æœ¬èª | è‹±èª | èª¬æ˜ |
|--------|------|------|
| èŠ | turf | èŠã‚³ãƒ¼ã‚¹ |
| ãƒ€/ãƒ€ãƒ¼ãƒˆ | dirt | ãƒ€ãƒ¼ãƒˆã‚³ãƒ¼ã‚¹ |

### ã‚³ãƒ¼ã‚¹å›ã‚Šï¼ˆtrack_directionï¼‰

| æ—¥æœ¬èª | è‹±èª | èª¬æ˜ |
|--------|------|------|
| å³ | right | å³å›ã‚Šã‚³ãƒ¼ã‚¹ |
| å·¦ | left | å·¦å›ã‚Šã‚³ãƒ¼ã‚¹ |
| ç›´ | straight | ç›´ç·šã‚³ãƒ¼ã‚¹ |

### å¤©å€™ï¼ˆweatherï¼‰

| æ—¥æœ¬èª | è‹±èª |
|--------|------|
| æ™´ | sunny |
| æ›‡ | cloudy |
| é›¨ | rainy |
| å°é›¨ | light_rain |
| é›ª | snowy |

### é¦¬å ´çŠ¶æ…‹ï¼ˆtrack_conditionï¼‰

| æ—¥æœ¬èª | è‹±èª | èª¬æ˜ |
|--------|------|------|
| è‰¯ | firm | è‰¯é¦¬å ´ |
| ç¨/ç¨é‡ | good | ç¨é‡é¦¬å ´ |
| é‡ | yielding | é‡é¦¬å ´ |
| ä¸è‰¯ | soft | ä¸è‰¯é¦¬å ´ |

## ğŸ”— æ©Ÿæ¢°å­¦ç¿’ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¸ã®çµ±åˆ

### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†

```bash
# ã™ã¹ã¦ã®å¹´ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰å‡¦ç†
python batch_preprocess.py data/horse_race_data_*.csv
```

### ã‚¹ãƒ†ãƒƒãƒ—2: å‡¦ç†æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã§å­¦ç¿’

```bash
# å‰å‡¦ç†æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã‚’dataãƒ•ã‚©ãƒ«ãƒ€ã«é…ç½®
mkdir -p data
mv *_processed.csv data/

# å­¦ç¿’å®Ÿè¡Œ
python train_lgbm_ranker_improved.py
```

å­¦ç¿’ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒè‡ªå‹•çš„ã«`distance`ã‚«ãƒ©ãƒ ã‚’èªè­˜ã—ã€ã‚¹ãƒ”ãƒ¼ãƒ‰ç‰¹å¾´é‡ãªã©ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

## ğŸ¯ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å…¨ä½“

```
å…ƒãƒ‡ãƒ¼ã‚¿ (horse_race_data_2019.csv)
    â†“
å‰å‡¦ç† (preprocess_race_data.py)
    â†“
å‡¦ç†æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ (horse_race_data_2019_processed.csv)
    â†“ dataãƒ•ã‚©ãƒ«ãƒ€ã«é…ç½®
å­¦ç¿’ (train_lgbm_ranker_improved.py)
    â†“
ãƒ¢ãƒ‡ãƒ« (outputs/horse_racing_lgbm_ranker.txt)
    â†“
äºˆæ¸¬ (predict.py)
```

## ğŸ’¡ ãƒ’ãƒ³ãƒˆ

### å‡¦ç†æ™‚é–“ã®ç›®å®‰

- 1ä¸‡è¡Œ: æ•°ç§’
- 5ä¸‡è¡Œ: 10-15ç§’
- 10ä¸‡è¡Œ: 20-30ç§’

### ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡

é€šå¸¸ã®CSVãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ10ä¸‡è¡Œç¨‹åº¦ï¼‰ã§ã‚ã‚Œã°ã€2GBæœªæº€ã®ãƒ¡ãƒ¢ãƒªã§å‡¦ç†å¯èƒ½ã§ã™ã€‚

### ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸå ´åˆ

#### race_detailsã‚«ãƒ©ãƒ ãŒãªã„
```python
# ã‚«ãƒ©ãƒ åã‚’ç¢ºèª
import pandas as pd
df = pd.read_csv("your_file.csv")
print(df.columns.tolist())
```

ã‚«ãƒ©ãƒ åãŒç•°ãªã‚‹å ´åˆã¯ã€`preprocess_race_data.py`å†…ã®ä»¥ä¸‹ã®è¡Œã‚’ä¿®æ­£ï¼š
```python
if 'race_details' in df.columns:
    # â†‘ ã“ã“ã‚’å®Ÿéš›ã®ã‚«ãƒ©ãƒ åã«å¤‰æ›´
```

#### è·é›¢ãŒæŠ½å‡ºã§ããªã„

`race_details`ã®å½¢å¼ãŒæƒ³å®šã¨ç•°ãªã‚‹å ´åˆã€æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’èª¿æ•´ï¼š

```python
# extract_distanceé–¢æ•°å†…
match = re.search(r'(\d{3,4})m', str(race_details))
# â†‘ ã“ã®æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’èª¿æ•´
```

## ğŸ“¦ ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

- `preprocess_race_data.py` - ãƒ¡ã‚¤ãƒ³å‰å‡¦ç†ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- `batch_preprocess.py` - è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ä¸€æ‹¬å‡¦ç†
- `horse_race_data_2019_processed.csv` - å‡¦ç†ä¾‹ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰

## ğŸ¤ ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€ä»¥ä¸‹ã®æƒ…å ±ã¨å…±ã«ã”ç›¸è«‡ãã ã•ã„ï¼š

1. `race_details`ã‚«ãƒ©ãƒ ã®ã‚µãƒ³ãƒ—ãƒ«ï¼ˆ3-5è¡Œï¼‰
2. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¨æ–‡
3. ä½¿ç”¨ã—ã¦ã„ã‚‹CSVãƒ•ã‚¡ã‚¤ãƒ«ã®è¡Œæ•°

```bash
# ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèªæ–¹æ³•
head -5 your_file.csv
```
